branches:
  only:
    - master
    - develop_controller_refactor
sudo: required
dist: trusty
language: python
python:
  - 3.4
jdk:
  - openjdk7
before_script:
  - sudo apt-get update -qq
  - echo $USER
#  - sudo bash ./deploy/provision.sh
  - sudo useradd -m -s /bin/bash -p $(openssl passwd -crypt "jenkins") -U "jenkins"
  - echo "jenkins ALL=(ALL) NOPASSWD:ALL" | sudo tee -a /etc/sudoers

#  - source /opt/venv_nstat/bin/activate

  - pip3 $pip_options install -r  bottle==0.12.8
  - pip3 $pip_options install -r requests==2.7.0
  - pip3 $pip_options install -r pyparsing==2.1.5
  - pip3 $pip_options install -r tornado==4.3
  - pip3 $pip_options install -r pytz==2016.4
  - pip3 $pip_options install -r six==1.10.0
  - pip3 $pip_options install -r stdeb==0.8.5
  - pip3 $pip_options install -r dpkt==1.8.6.2
  - pip3 $pip_options install -r collections-extended
  - pip3 $pip_options install -r coveralls==1.1
  - pip3 $pip_options install -r numpy==1.11.1
  - pip3 $pip_options install -r paramiko==1.15.2
  - pip3 $pip_options install -r cryptography==1.2.1
  - export PYTHONPATH=$(pwd)


script:
  - echo "Running Unittests"
  - coverage erase
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./stress_test/controller_test_basic.py ./stress_test/controller_test.json ./controllers/odl_beryllium_pb/
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_stats.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_cpu.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_customsubprocess.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_numeric.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_file.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_sysstats.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_html.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_process.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./util/unittests/test_netutil.py
  - coverage run --omit='/usr/local/lib/python3.4/*' --include='./util/*.py' --parallel-mode ./stress_test/nstat_orchestrator.py --help
  - coverage combine
after_success:
  coveralls
  deactivate
notifications:
  email: false
